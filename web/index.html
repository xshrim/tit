<!DOCTYPE html>
<html>

<head>
  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1">
  <title>TIT系统</title>
  <link rel="stylesheet" href="./layui/css/layui.css">
  <link rel="stylesheet" href="./vditor/dist/index.css" />
  <link rel="stylesheet" href="./reset/font-awesome.css" />
  <link rel="stylesheet" href="./reset/style.css">
  <script src="./layui/layui.js"></script>
  <script src="./layui/xm-select.js"></script>
  <script src="./vditor/dist/index.min.js"></script>
  <script>
    //JavaScript代码区域
    var $ = layui.jquery;
    var util = layui.util;
    var element = layui.element;
    var laydate = layui.laydate;

    var panels = ["home", "change", "review", "ichange", "ireview", "itemplate", "idraft", "history", "system"];

    function getRect(elem) {
      //var rect = elem.getBoundingClientRect();
      var rect = elem[0].getBoundingClientRect();
      w = rect.width || rect.right - rect.left;
      h = rect.height || rect.bottom - rect.top;
      ww = document.documentElement.clientWidth; //浏览器可见宽
      hh = document.documentElement.clientHeight; //浏览器可见高
      return { // 兼容ie多出的两个px
        top: Math.floor(rect.top), // 元素顶边到浏览器底边距离
        bottom: Math.floor(hh - rect.bottom), // 元素底边到浏览器底边距离
        left: Math.floor(rect.left), // 元素左边到浏览器底边距离
        right: Math.floor(ww - rect.right) // 元素底右到浏览器底边距离
      };
    };

    function marginTop(from, to) {
      var fromRect = from[0].getBoundingClientRect();
      var toRect = to[0].getBoundingClientRect();
      return Math.floor(fromRect.top) - Math.floor(toRect.top)
    }

    function initVditor() {
      if (window.vditor !== undefined) {
        window.vditor.destroy;
      }
      window.vditor = new Vditor('vditor', {
        "cdn": "./vditor",
        "height": marginTop($("#footer"), $("#vditor")) - 40,
        //"theme": "dark",
        //"icon": "material",
        "cache": {
          "enable": false
        },
        "counter": {
          "enable": true
        },
        "toolbarConfig": {
          "pin": true
        },
        "outline": {
          "enable": true
        },
        "resize": {
          "enable": true
        },
        "speech": {
          "enable": true
        },
        "toolbar": [
          "outline", "headings", "bold", "italic", "strike", "line", "link", "|", "emoji", "table", "list", "ordered-list", "check", "outdent", "indent", "|", "quote", "code", "inline-code", "insert-after", "insert-before", "undo", "redo", "|", "upload", "record", "code-theme", "content-theme", "edit-mode", "both", "preview", "fullscreen", "export", "devtools", "info", "help", "br"
        ],
        "preview": {
          "markdown": {
            "mark": true,
            "toc": true
          },
          "hljs": {
            "lineNumber": true
          },
          "actions": [
            "desktop", "tablet", "mobile", "mp-wechat"
          ]
        },
      });
    }

    function togglePanel(panel) {
      panels.forEach(function (item, index, array) {
        // item数组中的当前项, index当前项的索引, array原始数组；
        if (panel === item) {
          $(`#${item}`).removeClass('layui-hide-md');
          $(`#${item}`).addClass('layui-show-md-block');
        } else {
          $(`#${item}`).addClass('layui-hide-md');
          $(`#${item}`).removeClass('layui-show-md-block');
        }
      });
    }
    function toggleMore(elem, vd) {
      if (elem.hasClass("fa-chevron-circle-down")) {
        elem.removeClass('fa-chevron-circle-down');
        elem.addClass('fa-chevron-circle-up');
        $("#full").removeClass('layui-hide-md');
      } else {
        elem.addClass('fa-chevron-circle-down');
        elem.removeClass('fa-chevron-circle-up');
        $("#full").addClass('layui-hide-md');
      }

      console.log(marginTop($("#footer"), $("#vditor")));
      //vd.vditor.options.height = marginTop($("#footer"), $("#vditor"));
    }

    function auth(token) {
      $.post("/api/v1/auth", function (data, status) {
        alert("Data: " + data + "\nStatus: " + status);
      });
    }

    function validate() {
      var user = layui.data('user');
      if (user === undefined || !auth(user.token)) {
        layer.open({
          type: 1
          , title: "用户登陆" //显示标题栏
          , closeBtn: false
          , area: '300px;'
          , shade: 0.8
          , id: 'LAY_layuipro' //设定一个id，防止重复弹出
          , btn: ['登陆']
          , btnAlign: 'c'
          , moveType: 1 //拖拽模式，0或者1
          , anim: 1
          , content: `
<div style="margin-top:20px;">
<form class="layui-form" action="">
  <div class="layui-form-item" style="margin-bottom:5px;">
    <div class="layui-inline" style="margin-right:0px;">
      <label class="layui-form-label" style="width:30px;"><i class="fa fa-lg fa-user" style="color:gray"></i></label>
      <div class="layui-input-inline">
        <input id="loginUserid" type="text" name="userid" autocomplete="off" placeholder="用户ID/Email" class="layui-input" style="height:38px; width:200px;">
      </div>
    </div>
  </div>
  <div class="layui-form-item" style="margin-bottom:5px;">
    <div class="layui-inline" style="margin-right:0px;">
      <label class="layui-form-label" style="width:30px;"><i class="fa fa-lg fa-unlock-alt" style="color:gray"></i></label>
      <div class="layui-input-inline">
        <input id="loginPasswd" type="password" name="passwd" lay-verify="required" placeholder="用户密码" autocomplete="off" class="layui-input" style="height:38px;width:200px;">
      </div>
    </div>
  </div>
</form>
</div>`
          , success: function (layero) {
            var btn = layero.find('.layui-layer-btn');
            btn.find('.layui-layer-btn0').click(function () {
              var userid = $("#loginUserid").val();
              var passwd = $("#loginPasswd").val();
              console.log(userid, passwd);
              location.reload();
              // 发送token签发请求,存储token,刷新页面
            });
          }
        });
      }

      return true;
    }

    $(function () {
      validate();

      togglePanel("change");


      //日期
      laydate.render({
        elem: '#date', type: 'datetime'
      });
      var principle = xmSelect.render({
        el: '#principle',
        tips: '投产人员',
        filterable: true,
        data: [
          { name: '水果', value: 1 },
          { name: '蔬菜', value: 2 },
          { name: '桌子', value: 3 },
          { name: '北京', value: 4 },
        ]
      });
      var kind = xmSelect.render({
        el: '#kind',
        tips: '投产类型',
        filterable: true,
        data: [
          { name: '水果', value: 1 },
          { name: '蔬菜', value: 2 },
          { name: '桌子', value: 3 },
          { name: '北京', value: 4 },
        ]
      });

      // console.log((document.documentElement.scrollHeight > document.documentElement.clientHeight) ? document.documentElement.scrollHeight : document.documentElement.clientHeight);
      //var vpos = getRect(document.getElementById("vditor"));

      initVditor();

      $(".menu").click(function () {
        togglePanel($(this).attr("lay-filter"));
      });
      $("#more").click(function () {
        toggleMore($(this), vditor);
      });

      //头部事件
      util.event('lay-header-event', {
        //左侧菜单事件
        menuLeft: function (othis) {
          layer.msg('展开左侧菜单的操作', { icon: 0 });
        }
        , menuRight: function () {
          layer.open({
            type: 1
            , content: '<div style="padding: 15px;">处理右侧面板的操作</div>'
            , area: ['260px', '100%']
            , offset: 'rt' //右上角
            , anim: 5
            , shadeClose: true
          });
        }
      });
    });
  </script>
</head>

<body class="layui-layout-body">
  <div class="layui-layout layui-layout-admin">
    <div class="layui-header">
      <div class="layui-logo">layui 后台布局</div>
      <!-- 头部区域（可配合layui已有的水平导航） -->
      <ul class="layui-nav layui-layout-left">
        <li class="layui-nav-item"><a href="">控制台</a></li>
        <li class="layui-nav-item"><a href="">商品管理</a></li>
        <li class="layui-nav-item"><a href="">用户</a></li>
        <li class="layui-nav-item">
          <a href="javascript:;">其它系统</a>
          <dl class="layui-nav-child">
            <dd><a href="">邮件管理</a></dd>
            <dd><a href="">消息管理</a></dd>
            <dd><a href="">授权管理</a></dd>
          </dl>
        </li>
      </ul>
      <ul class="layui-nav layui-layout-right">
        <li class="layui-nav-item layui-hide layui-show-md-inline-block">
          <a href="javascript:;">
            <img src="./image/avatar.png" class="layui-nav-img">
            tester
          </a>
          <dl class="layui-nav-child">
            <dd><a href="">Your Profile</a></dd>
            <dd><a href="">Settings</a></dd>
            <dd><a href="">Sign out</a></dd>
          </dl>
        </li>
        <li class="layui-nav-item" lay-header-event="menuRight" lay-unselect>
          <a href="javascript:;">
            <i class="layui-icon layui-icon-more-vertical"></i>
          </a>
        </li>
      </ul>
    </div>

    <div class="layui-side layui-bg-black">
      <div class="layui-side-scroll">
        <!-- 左侧导航区域（可配合layui已有的垂直导航） -->
        <ul class="layui-nav layui-nav-tree" lay-filter="side">
          <li class="layui-nav-item layui-nav-itemed">
            <a class="" href="javascript:;">投产变更</a>
            <dl class="layui-nav-child">
              <dd class="menu" lay-filter="change"><a href="javascript:;" tab_id="11" data-url="change.html">变更登记</a>
              </dd>
              <dd class="menu" lay-filter="review"><a href="javascript:;" tab_id="12" data-url="review.html">变更评审</a>
              </dd>
              <dd class="menu"><a href="javascript:;" tab_id="14" data-url="../index.html">超链接</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item">
            <a href="javascript:;">我的</a>
            <dl class="layui-nav-child">
              <dd class="menu" lay-filter="ichange"><a href="javascript:;" tab_id="21">我的变更</a></dd>
              <dd class="menu" lay-filter="ireview"><a href="javascript:;" tab_id="22">我的评审</a></dd>
              <dd class="menu" lay-filter="itemplate"><a href="javascript:;" tab_id="23">我的模板</a></dd>
              <dd class="menu" lay-filter="idraft"><a href="javascript:;" tab_id="24">我的草稿</a></dd>
              <dd class="menu"><a href="">超链接</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item">
            <a href="javascript:;">统计分析</a>
            <dl class="layui-nav-child">
              <dd class="menu" lay-filter="history"><a href="javascript:;" tab_id="31">变更列表</a></dd>
              <dd class="menu" lay-filter="system"><a href="javascript:;" tab_id="32">系统清单</a></dd>
              <dd class="menu"><a href="">超链接</a></dd>
            </dl>
          </li>
          <li class="layui-nav-item"><a href="">云市场</a></li>
          <li class="layui-nav-item"><a href="">发布商品</a></li>
        </ul>
      </div>
    </div>

    <div class="layui-body">
      <!-- 内容主体区域 -->
      <div id="home" class="layui-fluid layui-show-md-block"
        style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <form class="layui-form" action="">
          <div class="layui-row layui-form-item">
            <div class="layui-col-md2">
              <label class="layui-form-label">需求编号</label>
              <div class="layui-input-block">
                <input type="text" name="title" required lay-verify="required" placeholder="请输入标题" autocomplete="off"
                  class="layui-input">
              </div>
            </div>
            <div class="layui-col-md2">
              <label class="layui-form-label">需求等级</label>
              <div class="layui-input-block">
                <select name="interest" lay-filter="aihao">
                  <option value=""></option>
                  <option value="0">写作</option>
                  <option value="1" selected="">阅读</option>
                  <option value="2">游戏</option>
                  <option value="3">音乐</option>
                  <option value="4">旅行</option>
                </select>
              </div>
            </div>
            <div class="layui-col-md4 layui-col-md-offset4">
              偏移4列，从而在最右
            </div>
          </div>
        </form>
      </div>

      <div id="change" class="layui-fluid layui-hide-md" style="padding: 8px; margin-left: 10px; margin-right: 10px;">
        <form class="layui-form" action="">
          <!-- <fieldset class="layui-elem-field layui-field-title" style="margin-top: 5px;margin-bottom: 5px;">
            <legend>变更信息</legend>
          </fieldset> -->
          <div class="layui-form-item" style="margin-bottom: 0px;">
            <div class="layui-row">
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-cube"
                    style="color:gray"></i></label>
                <div class="layui-input-inline">
                  <select name="modules" lay-verify="required" lay-search="">
                    <option value="">变更系统</option>
                    <option value="1">大投行业务平台</option>
                    <option value="2">企业客户CRM</option>
                    <option value="3">股权激励服务系统</option>
                    <option value="4">网下投资者发行服务系统</option>
                  </select>
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-ticket"
                    style="color:gray"></i></label>
                <div class="layui-input-inline">
                  <select name="interest" lay-filter="aihao" lay-search="">
                    <option value="">变更级别</option>
                    <option value="0">[重大]其他</option>
                    <option value="1">[重要]其他</option>
                    <option value="2">[一般]其他</option>
                    <option value="3">[简易]其他</option>
                  </select>
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-clock-o"
                    style="color:gray"></i></label>
                <div class="layui-input-inline">
                  <input type="text" name="date" id="date" lay-verify="date" placeholder="投产时间" autocomplete="off"
                    class="layui-input">
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-inbox"
                    style="color:gray"></i></label>
                <div class="layui-input-inline">
                  <div id="kind" class="xm-select-demo"></div>
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-user-plus"
                    style="color:gray"></i></label>
                <div class="layui-input-inline">
                  <div id="principle" class="xm-select-demo"></div>
                </div>
              </div>
              <div class="layui-inline">
                <div class="layui-input-inline" style="width:80px;margin-left:20px;">
                  <input type="checkbox" name="" title="停机" style="width:10px;">
                </div>
              </div>

              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i class="fa fa-lg fa-align-left"
                    style="color:gray"></i></label>
                <div class="layui-input-inline" style="width: 250px;">
                  <input type="text" name="title" required lay-verify="required" placeholder="变更标题" autocomplete="off"
                    class="layui-input">
                </div>
              </div>
              <div class="layui-inline">
                <label class="layui-form-label" style="width:6px;"><i id="more" class="fa fa-lg fa-chevron-circle-down"
                    style="color:gray"></i></label>
              </div>
            </div>
          </div>

          <div id="full" class="layui-hide-md">
            <div class="layui-form-item">
              <div class="layui-col-md2">
                <div class="layui-input-inline">
                  <input type="text" name="title" required lay-verify="required" placeholder="需求编号" autocomplete="off"
                    class="layui-input">
                </div>
              </div>
              <div class="layui-col-md2">
                <div class="layui-input-inline">
                  <select name="interest" lay-filter="aihao" lay-search="">
                    <option value="">需求等级</option>
                    <option value="0">写作</option>
                    <option value="1">阅读</option>
                    <option value="2">游戏</option>
                    <option value="3">音乐</option>
                    <option value="4">旅行</option>
                  </select>
                </div>
              </div>

              <div class="layui-col-md2">
                <div class="layui-input-inline">
                  <div class="layui-btn-group">
                    <button type="button" class="layui-btn layui-btn-primary layui-btn">修复</button>
                    <button type="button" class="layui-btn layui-btn-primary layui-btn">新特性</button>
                  </div>
                </div>
              </div>
              <div class="layui-col-md2">
                <div class="layui-input-inline">
                  <div id="principle" class="xm-select-demo"></div>
                </div>
              </div>
              <div class="layui-col-md4">
                <div class="layui-input-inline" style="width: 100%">
                  <input type="text" name="title" required lay-verify="required" placeholder="需求标题" autocomplete="off"
                    class="layui-input">
                </div>
              </div>
            </div>
          </div>

          <div class="layui-tab layui-tab-brief" lay-filter="doc" style="margin-top: 0px; margin-bottom: 0px;">
            <ul class="layui-tab-title">
              <li class="layui-this">投产手册</li>
              <li>评审表</li>
            </ul>
            <div class="layui-tab-content" style="padding-top: 5px; padding-bottom: 5px;">
              <div class="layui-tab-item layui-show">
                <div id="vditor" class="vditor layui-fluid"
                  style="padding: 5px; margin-left: 10px; margin-right: 10px;"></div>
              </div>
              <div class="layui-tab-item">内容2</div>
            </div>
          </div>
          <div id="chsubmit" class="layui-btn-container" style="margin-left: 10px;">

            <button type="button" class="layui-btn layui-btn-sm" style="margin-bottom: 0px;">提交</button>
            <button type="button" class="layui-btn layui-btn-sm" style="margin-bottom: 0px;">保存</button>
            <button type="button" class="layui-btn layui-btn-sm" style="margin-bottom: 0px;">模板</button>
            <button type="button" class="layui-btn layui-btn-sm" style="margin-bottom: 0px;">清空</button>
          </div>
        </form>
      </div>

      <div id="review" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            review
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>

      <div id="ichange" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            ichange
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>
      <div id="ireview" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            ireview
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>
      <div id="itemplate" class="layui-fluid layui-hide-md"
        style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            itemplate
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>
      <div id="idraft" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            idraft
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>

      <div id="history" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            history
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>

      <div id="system" class="layui-fluid layui-hide-md" style="padding: 5px; margin-left: 10px; margin-right: 10px;">
        <div class="layui-row">
          <div class="layui-col-md4">
            system
          </div>
          <div class="layui-col-md4 layui-col-md-offset4">
            偏移5列，从而在最右
          </div>
        </div>
      </div>



    </div>

    <div id="footer" class="layui-footer">
      <!-- 底部固定区域 -->
      底部固定
    </div>
  </div>
</body>

</html>